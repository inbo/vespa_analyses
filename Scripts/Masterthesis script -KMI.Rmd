---
title: "Masterthesis script,weerparameters KMI "
author: "Heleen Van Ransbeeck"
date: "2023-02-27"
output:
  html_document: default
  pdf_document: default
---

# Data inladen

```{r}
KMIdata<-read.table(file = "~/GitHub/vespa_analyses/Input/KMIdata.txt", header=TRUE, sep="\t", na.strings=c("","NA"))
Eigendata<-read.table(file = "~/GitHub/vespa_analyses/Input/Eigendata.txt", header=TRUE, sep="\t")
Eigendata_shortind<-read.table(file = "~/GitHub/vespa_analyses/Input/Eigendata_shortind.txt", header=TRUE, sep="\t")


library(dplyr)
library(ggplot2)
library(ggpubr)
```




Volgende datasets zijn gecreëerd:

- KMIdata: dataset met alle vliegtijden en parameters (KMI)

Voor het model: *Flight time ~ Distance*
gebruiken we de dataset vliegtijden per individu
Omdat we hiermee de theoretische regel 1min=100m kunnen verifiëren.
De imkers nemen hiervoor altijd kortste meting

Voor modellen met *weerparameters, gewicht, urbanisatie*:
Hiervoor nemen we telkens de hele dataset, omdat elke meting van deze 
factoren afhangt.


**Outlier van nest 29, Bait 1, Individu A weggelaten in deze dataset. (600m op 2min lijkt wel heel snel)**

**Outlier van Melle ook weggelaten (meting op 2 km niet betrouwbaar)**

**Meting in Excel script wel nog terug te vinden.**







# Graph Temperature vs Urbanisation

Van temperatuur ook categorische variabele maken (aanraden van Prof.Vangestel)

```{r}
KMIdata$Temperature_cat<-cut(KMIdata$Temperature, c(8,13,17,21,25,29,33))
ggplot(data=subset(KMIdata, !is.na(Temperature_cat)), aes(x=Temperature_cat)) + geom_bar(fill="lightcoral")
```

Van urbanisatie categorische variabele maken o.b.v. de percentages.

```{r}
KMIdata$Urbanisation_cat<-cut(KMIdata$Traject100m, c(0,0.2,0.4,0.6))
ggplot(data=subset(KMIdata, !is.na(Urbanisation_cat)), aes(x=Urbanisation_cat)) + geom_bar(fill="lightcoral")
```

```{r}
ggplot(data=subset(KMIdata, !is.na(Temperature_cat)), aes(x=Temperature_cat, col=Temperature_cat, y=Traject100m)) + geom_boxplot() + guides(color = guide_legend(title = "Temperature ranges (°C)"))+ ggtitle("Urbanisation per range of temperatures") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_y_continuous(name="Urbanisation", breaks=seq(0,0.5,0.1))+ scale_color_manual(values=c("#F564E3","darkorange2","gold","seagreen3", "dodgerblue2", "dodgerblue4" ))


ggplot(data=KMIdata, aes(x=Temperature_KMI, y=Traject100m)) + geom_point(color="turquoise")


ggplot(data=subset(KMIdata, !is.na(Temperature_cat)), aes(x=Urban_EN, col=Urban_EN, y=Temperature_KMI)) + geom_boxplot() + guides(color = guide_legend(title = "Regional urbanisation"))+ ggtitle("Temperature measurements per type of regional urbanisation") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_y_continuous(name="Temperature (°C)", breaks=seq(0,30,5))

ggplot(data=subset(KMIdata, !is.na(Urbanisation_cat)), aes(x=Urbanisation_cat, col=Urbanisation_cat, y=Temperature_KMI)) + geom_boxplot() + guides(color = guide_legend(title = "Local urbanisation"))+ ggtitle("Temperature measurements per range of local urbanisation") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_y_continuous(name="Temperature (°C)", breaks=seq(0,30,5)) 
```



# 1.1) ForagingSpeed vs Temperature

## Graphs

```{r echo=FALSE, warning=FALSE}
ggplot(subset(KMIdata, !is.na(Urban_EN)), aes(x=Temperature_KMI, y=ForagingSpeed, group=interaction(Urban_EN), col=Urban_EN)) + geom_point() + 
  geom_abline(intercept=4.33558, slope=-0.01654, color="darkorange", linewidth=1.2) + 
  geom_abline(intercept=0.8106, slope=0.10926 , color="seagreen3", linewidth=1.2) + 
  geom_abline(intercept=2.70976, slope=-0.04145, color="dodgerblue2", linewidth=1.2) + guides(color = guide_legend(title = "Regional urbanisation")) + ggtitle("Temperature effect per type of regional urbanisation") + theme(plot.title = element_text(hjust = 0.5, size=14), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Temperature (°C)", limits=c(9, 30, 5)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) + scale_color_manual(values=c("darkorange","seagreen3", "dodgerblue2"))

ggplot(subset(KMIdata, !is.na(Urban_EN)), aes(x=Temperature_KMI, y=ForagingSpeed, group=interaction(Urban_EN), col=Urban_EN)) + geom_point() + 
  geom_hline(yintercept=3.988, color="darkorange", linewidth=1.2) + 
  geom_hline(yintercept=2.79, color="seagreen3", linewidth=1.2) + 
  geom_hline(yintercept=2.055, color="dodgerblue2", linewidth=1.2) + guides(color = guide_legend(title = "Regional urbanisation")) + ggtitle("Temperature effect per type of regional urbanisation") + theme(plot.title = element_text(hjust = 0.5, size=14), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Temperature (°C)", limits=c(9, 30, 5)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) + scale_color_manual(values=c("darkorange","seagreen3", "dodgerblue2"))


ggplot(subset(KMIdata, !is.na(Urbanisation_cat)), aes(x=Temperature_KMI, y=ForagingSpeed, group=interaction(Urbanisation_cat), col=Urbanisation_cat)) + geom_point() + guides(color = guide_legend(title = "Local urbanisation")) +  
  geom_abline(intercept=2.72205, slope=-0.03435, color="seagreen3", linewidth=1.2) + 
  geom_abline(intercept=4.71625, slope=-0.29038, color="dodgerblue2", linewidth=1.2) + 
  geom_abline(intercept=2.21050, slope=0.06496, color="darkorange", linewidth=1.2) + ggtitle("Temperature effect per type of local urbanisation") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Temperature (°C)", limits=c(9, 30, 5)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) + scale_color_manual(    values=c("darkorange","seagreen3","dodgerblue2"))
```


## Model Output


```{r}
library(lmerTest)
library(lme4)
library(ggeffects)

model_temp_urb<-lmer(ForagingSpeed ~ Temperature_KMI + Urbanisation_cat + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_temp_urb)

res<-residuals(model_temp_urb)
shapiro.test(res)
qqnorm(res)
qqline(res)


model_temp_urb_int<-lmer(ForagingSpeed ~ Temperature_KMI + Urbanisation_cat + Temperature_KMI*Urbanisation_cat + (1|Individualcode), na.action=na.omit, data=KMIdata)
anova(model_temp_urb)
summary(model_temp_urb_int)

res<-residuals(model_temp_urb_int)
shapiro.test(res)
qqnorm(res)
qqline(res)

anova(model_temp_urb, model_temp_urb_int)

ggpredict(model_temp_urb, c("Temperature_KMI", "Urbanisation_cat")) %>% 
  plot(add.data=T, limit.range=T) + scale_x_continuous(name="Temperature (°C)") + scale_y_continuous(name="Foraging speed   (m/s)") +
  scale_color_manual(values=c('darkorange','seagreen3', 'dodgerblue2'))+
  scale_fill_manual(values=c('darkorange','seagreen3', 'dodgerblue2'), name="fill")+
  labs(colour="Local urbanisation", title="Temperature effect per local urbanisation level | interaction excluded")


# Generate the plot and set the colors
ggpredict(model_temp_urb_int, c("Temperature_KMI", "Urbanisation_cat")) %>% 
  plot(add.data=T, limit.range=T) + scale_x_continuous(name="Temperature (°C)") + scale_y_continuous(name="Foraging speed   (m/s)") +
  scale_color_manual(values=c('darkorange','seagreen3', 'dodgerblue2'))+
  scale_fill_manual(values=c('darkorange','seagreen3', 'dodgerblue2'), name="fill")+
  labs(colour="Local urbanisation", title="Temperature effect per local urbanisation level | interaction included")
```

```{r}
library(lmerTest)
library(lme4)

model_temp_urb<-lmer(ForagingSpeed ~ Temperature_KMI + Urban_EN + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_temp_urb)
anova(model_temp_urb)

res<-residuals(model_temp_urb)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_temp_urb_int<-lmer(ForagingSpeed ~ Temperature_KMI + Urban_EN + Temperature_KMI*Urban_EN + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_temp_urb_int)
anova(model_temp_urb_int)

res<-residuals(model_temp_urb_int)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_temp<-lmer(ForagingSpeed ~ Temperature_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_temp_urb_int)

anova(model_temp_urb, model_temp)
library(ggeffects)

ggpredict(model_temp_urb, c("Temperature_KMI", "Urban_EN")) %>% 
  plot(add.data=T, limit.range=T) + scale_x_continuous(name="Temperature (°C)") + scale_y_continuous(name="Foraging speed   (m/s)") +
  scale_color_manual(values=c('darkorange','seagreen3', 'dodgerblue2'))+
  scale_fill_manual(values=c('darkorange','seagreen3', 'dodgerblue2'), name="fill")+
  labs(colour="Regional urbanisation", title="Temperature effect per regional urbanisation level | interaction excluded")


ggpredict(model_temp_urb_int, c("Temperature_KMI", "Urban_EN")) %>% 
  plot(add.data=T, limit.range=T) + scale_x_continuous(name="Temperature (°C)") + scale_y_continuous(name="Foraging speed   (m/s)") +  scale_color_manual(values=c('darkorange','seagreen3', 'dodgerblue2'))+
  scale_fill_manual(values=c('darkorange','seagreen3', 'dodgerblue2'), name="fill")+
  labs(colour="Regional urbanisation", title="Temperature effect per regional urbanisation level | interaction included")
```















# 1.2) Flight time vs Distance + Temperature

## Graph

**VRAAG: Kan dit ook met mixed model?**

```{r}
library(knitr)
library(kableExtra)
library("plot3D")

x <- KMIdata$Distance
y <- KMIdata$Temperature_KMI
z <- KMIdata$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 210, phi = 10, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Temperature", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Temperature")
```











# 2) ForagingSpeed vs Cloudcoverage

## Graphs

```{r warning=FALSE}
ggplot(KMIdata, aes(x=Cloudcoverage_KMI, y=ForagingSpeed)) + geom_point(color="dodgerblue2") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="dodgerblue4") + theme(plot.title = element_text(hjust = 0.5, size=10)) + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Cloud coverage", limits=c(0, 1)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5))

ggplot(KMIdata, aes(x=Cloudcoverage_KMI, y=ForagingSpeed)) + geom_point(color="dodgerblue2") + geom_abline(intercept=3.1073, slope=-0.3505, color="dodgerblue4", linewidth=1.2) + theme(plot.title = element_text(hjust = 0.5, size=10)) + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Cloud coverage", limits=c(0, 1)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5))

```


## Model Ouput


```{r}
model_cloud_all<-lmer(ForagingSpeed ~ Cloudcoverage_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_cloud_all)
anova(model_cloud_all, ddf="Satterthwaite", type=3)

res<-residuals(model_cloud_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
library(ggeffects)
dat <- ggpredict(model_cloud_all, terms = "Cloudcoverage_KMI")
plot(dat, colors = "dodgerblue2", rawdata=T) +
    labs(x = "Cloud coverage", y = "Foraging speed (m/s)")
```

















# 3) ForagingSpeed vs Windspeed | Afhankelijk van de windrichting

## Graphs

Telkens voor de modellen: 

ForagingSpeed \~ Windspeed 

ForagingSpeed \~ Windspeed²

Er werd ook telkens voor elke meting nagegaan of de hoornaar met
meewind (tailwind), tegenwind (upwind) of loodrechte wind
(perpendicular) te maken had. Dit volgens de formules:

\|𝜃flight −𝜃wind\| ≤ 45 is tailwind

45 \< \|𝜃flight −𝜃wind\|\<135 is (quasi) perpendicular

\|𝜃 flight −𝜃wind\| ≥135 upwind


Windrichting werd telkens bepaald t.o.v. de vliegrichting (**Wind_flight**) en t.o.v. richting tot het nest (**Wind_nest**). 

Werken verder met Wind_flight

```{r warning=FALSE}
ggplot(subset(KMIdata, !is.na(Wind_flight)), aes(x=WindSpeed_KMI, y=ForagingSpeed, group=interaction(Wind_flight), col=Wind_flight)) + geom_point() + ggtitle("Quadratic wind speed effect per wind direction") + geom_smooth(method="lm", formula =y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95) + guides(color = guide_legend(title = "Wind direction")) + scale_color_manual(values=c("seagreen3", "dodgerblue2", "darkorange")) + theme(plot.title = element_text(hjust = 0.5, size=10)) + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Wind speed (m/s)", limits=c(0, 8)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) 

function_perp <- function(x){
  3.556748 -0.025064*x^2
}
function_tail <- function(x){
  3.460683 -0.036669*x^2
}
function_up <- function(x){
  3.17182 -0.008821*x^2
}

ggplot(subset(KMIdata, !is.na(Wind_flight)), aes(x=WindSpeed_KMI, y=ForagingSpeed, group=interaction(Wind_flight), col=Wind_flight)) + geom_point() + ggtitle("Quadratic wind speed effect per wind direction") + 
  stat_function(fun = function_perp, size=1.2, color='seagreen3') + 
  stat_function(fun = function_up, size=1.2, color='darkorange') + 
  stat_function(fun = function_tail, size=1.2, color='dodgerblue3') + 

  guides(color = guide_legend(title = "Wind direction")) + scale_color_manual(values=c("seagreen3", "dodgerblue2", "darkorange")) + theme(plot.title = element_text(hjust = 0.5, size=10)) + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Wind speed (m/s)", limits=c(0, 8)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) 


```

## Model Output


```{r}
library(ggeffects)
model_wind1_all<-lmer(ForagingSpeed ~ I(WindSpeed_KMI^2) + Wind_flight + I(WindSpeed_KMI^2)*Wind_flight + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_wind1_all)
anova(model_wind1_all, ddf="Satterthwaite", type=3)
res<-residuals(model_wind1_all)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_wind2_all<-lmer(ForagingSpeed ~ I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_wind2_all)
anova(model_wind2_all, ddf="Satterthwaite", type=3)

ggpredict(model_wind1_all, c("WindSpeed_KMI [all]", "Wind_flight")) %>% 
  plot(add.data=T) + scale_x_continuous(name="Windspeed (m/s)") + scale_y_continuous(name="Foraging speed   (m/s)", limits=c(0,7,5)) +  scale_color_manual(values=c('darkorange','seagreen3', 'dodgerblue2'))+
  scale_fill_manual(values=c('darkorange','seagreen3', 'dodgerblue2'), name="fill")+
  labs(colour="Wind direction", title="Wind speed effect per wind direction")

```

















# 4) ForagingSpeed vs Weight individual

## Graphs

```{r warning=FALSE}
ggplot(KMIdata, aes(x=Weight_ind, y=ForagingSpeed)) + geom_point(color="dodgerblue2") + geom_abline(intercept=2.5517, slope=-1.0014, linewidth=1.2, color="dodgerblue4") + theme(plot.title = element_text(hjust = 0.5, size=10)) + theme(plot.title = element_text(hjust = 0.5, size=17), axis.title=element_text(size=17), axis.text=element_text(size=13)) + scale_x_continuous(name="Individual weight (g)", limits=c(0.2,0.45)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,5)) 
```

## Model Output

```{r}
model_weight_all<-lm(ForagingSpeed ~ Weight_ind, na.action=na.omit, data=KMIdata)
summary(model_weight_all)

res<-residuals(model_weight_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```








# 5) ForagingSpeed vs Urbanisation

## Graphs

Urbanisatiecirkels niet berekend, meteen trajecten genomen want die zijn
betere maatstaf.


**Verder werken met 100m buffer!**

```{r, fig.width=6, fig.height=4}
# Meting in urbaan gebied met koude temperatuur weglaten (Nest 38 en 39, 3 wiekpotten)
# Uiteindelijk niet gebruikt, temperatuur als categorische genomen

KMIdata2<-KMIdata %>%  filter(Traject100m!=0.504960)
KMIdata2<-KMIdata2 %>%  filter(Traject100m!=0.496950)
KMIdata2<-KMIdata2 %>%  filter(Traject100m!=0.411898)

ggplot(subset(KMIdata, !is.na(Temperature_cat)), aes(x=Traject100m, y=ForagingSpeed, group=interaction(Temperature_cat), col=Temperature_cat)) + geom_point() + guides(color = guide_legend(title = "Temperature (°C)")) + 
  geom_abline(intercept=3.3446, slope=-3.5265, linewidth=1.2, color='#F564E3')+
  geom_abline(intercept=3.986, slope=-7.3895, linewidth=1.2, color='darkorange2')+
  geom_abline(intercept=3.9931, slope=-7.0185, linewidth=1.2, color='gold')+
  geom_abline(intercept=4.365, slope=-6.3697, linewidth=1.2, color='seagreen3')+
  geom_abline(intercept=3.457, slope=-2.5486, linewidth=1.2, color='dodgerblue2')+
  geom_abline(intercept=3.7289, slope=-3.5265, linewidth=1.2, color='dodgerblue4')+

ggtitle("Local urbanisation effect per temperature category") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_continuous(name="Local urbanisation", limits=c(0, 0.58, 0.1)) + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) + scale_color_manual(values=c("#F564E3","darkorange2","gold","seagreen3", "dodgerblue2", "dodgerblue4" ))

ggplot(subset(KMIdata, !is.na(Temperature_cat)), aes(y=ForagingSpeed, group=interaction(Temperature_cat), col=Temperature_cat)) + geom_boxplot() +  facet_wrap(~Urban_EN)+ guides(color = guide_legend(title = "Temperature (°C)")) + ggtitle("Regional urbanisation effect per temperature category") + theme(plot.title = element_text(hjust = 0.5, size=15), axis.title=element_text(size=13), axis.text=element_text(size=13)) + scale_x_discrete(name="Regional urbanisation") + scale_y_continuous(name="Foraging speed (m/s)", limits=c(0,7,5)) + scale_color_manual(values=c("#F564E3","darkorange2","gold","seagreen3", "dodgerblue2", "dodgerblue4" ))

```


## Model Output


```{r}
model_urb1<-lmer(ForagingSpeed ~ Traject100m + Temperature_cat + Traject100m*Temperature_cat + (1|Individualcode),  na.action=na.omit, data=KMIdata)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)

model_urb2<-lmer(ForagingSpeed ~ Traject100m + Temperature_cat  + (1|Individualcode),  na.action=na.omit, data=tempdata)
summary(model_urb2)
anova(model_urb1, ddf="Satterthwaite", type=3)



model_urb3<-lmer(ForagingSpeed ~ Traject100m  + (1|Individualcode),  na.action=na.omit, data=tempdata)
summary(model_urb3)
anova(model_urb1, ddf="Satterthwaite", type=3)


res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```










# 6) Flight error vs urbanisation

Flight error is the difference between the actual angle from the bait to
the nest and the flight direction I measured.


## Graphs

```{r}
ggplot(data=KMIdata, aes(x=Traject100m, y=FlightError)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")
```


## Model Output

 - Niet significant
 
 - Normality niet ok!

```{r}
model_errurb100<-lmer(FlightError ~ Traject100m + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_errurb100)
anova(model_errurb100, ddf="Satterthwaite", type=3)

res<-residuals(model_errurb100)
shapiro.test(res)
qqnorm(res)
qqline(res)
```










# 7) Foragingspeed vs Flight error


```{r}
ggplot(data=KMIdata, aes(x=FlightError, y=ForagingSpeed)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")
```












# Forward model Selection


# Local urbanisation continuous

```{r}
fullmodel1<-lmer(ForagingSpeed ~ Traject100m + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel1)

res<-residuals(fullmodel1)
shapiro.test(res)
qqnorm(res)
qqline(res)

AIC(fullmodel1)
```

```{r}
fullmodel1_2<-lmer(ForagingSpeed ~ Traject100m*Temperature_cat + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel1_2)

res<-residuals(fullmodel1_2)
shapiro.test(res)
qqnorm(res)
qqline(res)

AIC(fullmodel1_2)
```

```{r}
fullmodel1_3<-lmer(ForagingSpeed ~ Traject100m + Weight_ind + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel1_3)

res<-residuals(fullmodel1_3)
shapiro.test(res)
qqnorm(res)
qqline(res)

AIC(fullmodel1_3)
```




# Local urbanisation discrete

```{r}
fullmodel2<-lmer(ForagingSpeed ~ Urbanisation_cat + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel2)

res<-residuals(fullmodel2)
shapiro.test(res)
qqnorm(res)
qqline(res)

AIC(fullmodel2)
```



# Regional urbanisation 

```{r}
fullmodel3<-lmer(ForagingSpeed ~ Urban_EN + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel3)

res<-residuals(fullmodel3)
shapiro.test(res)
qqnorm(res)
qqline(res)

AIC(fullmodel3)
```






# Backward model Selection

```{r}
library(MASS)
fullmodel<-lmer(ForagingSpeed ~ Traject100m*Temperature_cat + I(WindSpeed_KMI^2)*Wind_flight + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel)
stepAIC(fullmodel)
```

```{r}
fullmodel<-lmer(ForagingSpeed ~ Traject100m*Temperature_cat + I(WindSpeed_KMI^2)*Wind_flight + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(fullmodel)

model1<-lmer(ForagingSpeed ~ Traject100m*Temperature_cat + I(WindSpeed_KMI^2) + Wind_flight + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model1)

model2<-lmer(ForagingSpeed ~ Traject100m+Temperature_cat + I(WindSpeed_KMI^2) + Wind_flight + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model2)

model3<-lmer(ForagingSpeed ~ Traject100m + I(WindSpeed_KMI^2) + Wind_flight + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model3)

model4<-lmer(ForagingSpeed ~ Traject100m + I(WindSpeed_KMI^2) + Wind_flight + Cloudcoverage_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model4)

model5<-lmer(ForagingSpeed ~ Traject100m + I(WindSpeed_KMI^2) + Cloudcoverage_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model5)

model6<-lmer(ForagingSpeed ~ Traject100m + I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model6)

model7<-lmer(ForagingSpeed ~ Traject100m * I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model7)

```




# Update rule of thumb

probeersel om distance als afhankelijke variabele te nemen
Komt rare dingen uit


```{r}
updaterule<-lm(Distance ~ Flighttime_min + Urban_EN + I(WindSpeed_KMI^2), na.action=na.omit, data=KMIdata)
summary(updaterule)

updaterule<-lm(Distance ~ Flighttime_min + Urban_EN, na.action=na.omit, data=KMIdata)
summary(updaterule)

updaterule<-lm(Distance ~ Flighttime_min + Urbanisation_cat, na.action=na.omit, data=KMIdata)
summary(updaterule)
```
```{r}
updaterule<-lm(Distance ~ Flighttime_min + Urban_EN, na.action=na.omit, data=Eigendata_shortind)
summary(updaterule)
```



# Multicollinearity check


```{r}
library(ggcorrplot)
library(car)

datacor<-KMIdata[ , c("Temperature_KMI", "Cloudcoverage_KMI", "WindSpeed_KMI", "Weight_ind", "Traject100m")]
source("~/GitHub/vespa_analyses/Input/HighstatLibV10.R") 
corvif(datacor)

cormat <- round(cor(datacor, use = "pairwise.complete.obs"), 2)
ggcorrplot(cormat, lab= TRUE, type = "lower", ggtheme = ggplot2::theme_gray,
   colors = c("dodgerblue3", "white", "darkorange2")) + scale_x_discrete(labels = c("Cloud coverage", "Wind speed", "Individual weight", "Urbanisation")) + scale_y_discrete(labels = c("Temperature", "Cloud coverage", "Wind speed", "Individual weight"))
```

