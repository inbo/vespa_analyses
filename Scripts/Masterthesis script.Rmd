---
title: "Masterthesis script, weerparameters "
author: "Heleen Van Ransbeeck"
date: "2023-01-03"
output:
  html_document: default
  pdf_document: default
---

# Data inladen

```{r}
Baits<-read.table(file = "~/GitHub/vespa_analyses/Input/Baits_useful.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Flights_incomplete<-read.table(file = "~/GitHub/vespa_analyses/Input/Flights_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Nests<-read.table(file = "~/GitHub/vespa_analyses/Input/Nests_useful.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Shortind_incomplete<-read.table(file = "~/GitHub/vespa_analyses/Input/Shortind_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Shortpot_incomplete<-read.table(file = "~/GitHub/vespa_analyses/Input/Shortpot_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Individuals<-read.table(file = "~/GitHub/vespa_analyses/Input/Individuals.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

```

-incomplete wil zeggen dat de weergegevens nog niet volledig zijn. Ik
wacht hiervoor op het KMI.

# Aanpassingen datasets

```{r}
# Overbodige kolommen wegdoen, foutje in excel
Flights_incomplete<-Flights_incomplete[1:(length(Flights_incomplete)-2)]
Shortind_incomplete<-Shortind_incomplete[1:(length(Shortind_incomplete)-2)]
Shortpot_incomplete<-Shortpot_incomplete[1:(length(Shortpot_incomplete)-2)]

#Foerageersnelheid en vliegsnelheid (m/s) toevoegen aan tabel
Flights_incomplete$ForagingSpeed<-Flights_incomplete$Distance/(Flights_incomplete$Flighttime_min*60)
Shortind_incomplete$ForagingSpeed<-Shortind_incomplete$Distance/(Shortind_incomplete$Flighttime_min*60)
Shortpot_incomplete$ForagingSpeed<-Shortpot_incomplete$Distance/(Shortpot_incomplete$Flighttime_min*60)

Flights_incomplete$FlightSpeed<-Flights_incomplete$Distance*2/(Flights_incomplete$Flighttime_min*60)
Shortind_incomplete$FlightSpeed<-Shortind_incomplete$Distance*2/(Shortind_incomplete$Flighttime_min*60)
Shortpot_incomplete$FlightSpeed<-Shortpot_incomplete$Distance*2/(Shortpot_incomplete$Flighttime_min*60)


## Urbanisatiecirkels per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"))
Shortpot_incomplete<-merge(Shortpot_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"))

## Urbanisatietrajecten per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"))
Shortpot_incomplete<-merge(Shortpot_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"))

## Gewicht individu per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Individuals[, c("NestID", "BaitID","ColorInd", "Weight_ind")], by=c("NestID", "BaitID", "ColorInd"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Individuals[, c("NestID", "BaitID", "ColorInd", "Weight_ind")], by=c("NestID", "BaitID", "ColorInd"))
Shortpot_incomplete<-merge(Shortpot_incomplete, Individuals[, c("NestID", "BaitID", "ColorInd","Weight_ind")], by=c("NestID", "BaitID", "ColorInd"))

## Nesthoogte per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"))
Shortpot_incomplete<-merge(Shortpot_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"))

library(ggplot2)
library(ggpubr)
```

Volgende datasets zijn gecreÃ«erd:

- Flights_incomplete: dataset met alle vliegtijden
- Shortind_incomplete: dataset met kortste vliegtijden per individu
- Shortpot_incomplete: dataset met kortste vliegtijden per wiekpot

**Voorstel:**
Voor het model: *Flight time ~ Distance*
zou ik de dataset vliegtijden per individu nemen (en eventueel per wiekpot?)
Omdat we hiermee de theoretische regel 1min=100m kunnen verifiÃ«ren.
De imkers nemen hiervoor altijd kortste meting

Voor modellen met weerparameters, gewicht, urbanisatie:
Hiervoor zou ik telkens de hele dataset gebruiken omdat elke meting van deze 
factoren afhangt.


# Datapunten op 2km weglaten

Deze metingen zijn nogal onzeker omdat deze waarnemingen ook van een
ander nest kunnen komen. Was op 2km afstand en in Melle zijn toch
redelijk wat nesten gevonden. Kans dat het van een nest is dat niet
gevonden werd is groot.

Als de website van Vespawatch in orde is kan ik kijken of er eventueel
een nest in de buurt is gevonden.

**Voorlopig gaan we verder met de dataset zonder de outliers in Melle**

```{r}
library(dplyr)
Flights2_incomplete<-Flights_incomplete %>%  filter(NestID!=1)
Shortind2_incomplete<-Shortind_incomplete %>%  filter(NestID!=1)
Shortpot2_incomplete<-Shortpot_incomplete %>%  filter(NestID!=1)
```








# Data exploratie


## 1) Flight Error vs Distance

### Graphs

```{r}
ggplot(Flights2_incomplete, aes(x=Distance, y=FlightError)) + geom_point(color="cadetblue2") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="cadetblue") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))
```

### Model Output
```{r}
model_angledist<-lm(FlightError ~ Distance, na.action=na.exclude, data=Flights2_incomplete)
summary(model_angledist)
```


## 2) FlightSpeed vs Temperature

### Graphs

Grafieken zonder outliers telkens voor de volgende datasets 
- volledige dataset 
- enkel kortste vliegtijden per individu 
- enkel kortste vliegtijden per wiekpot

```{r echo=FALSE, warning=FALSE}
plot7<-ggplot(Flights2_incomplete, aes(x=Temperature, y=FlightSpeed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot8<-ggplot(Shortind2_incomplete, aes(x=Temperature, y=FlightSpeed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot9<-ggplot(Shortpot2_incomplete, aes(x=Temperature, y=FlightSpeed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot7, plot8, plot9 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

### Model Output

**All data** 
Hoogsignificant

```{r}
model_temp_all<-lm(FlightSpeed ~ Temperature, na.action=na.exclude, data=Flights2_incomplete)
summary(model_temp_all)
```



## 3) Flight time vs Distance + Temperature

### Graph

```{r}
library(knitr)
library(kableExtra)
library("plot3D")

x <- Flights2_incomplete$Distance
y <- Flights2_incomplete$Temperature
z <- Flights2_incomplete$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 210, phi = 10, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Temperature", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Temperature")
```
**Met plotly**

Had met deze link problemen met expand.grid
https://stackoverflow.com/questions/38331198/add-regression-plane-to-3d-scatter-plot-in-plotly


Dan maar dat van hierboven gebruikt, maar nu klopt er precies iets niet?
Alle datapunten liggen boven het oppervlak.

```{r}
library(plotly)
library(tidyverse)

FlightsNoNA<-Flights2_incomplete %>%  filter(Flighttime_min!="NA")
FlightsNoNA<-FlightsNoNA %>%  filter(Temperature!="NA")


fig <- plot_ly(FlightsNoNA, x = ~Distance, y = ~Temperature, z = ~Flighttime_min, size=1)
fig <- fig %>% add_markers()
fig <- fig %>% layout(scene = list(xaxis = list(title = 'Distance'),
                     yaxis = list(title = 'Temperature'),
                     zaxis = list(title = 'Flight time (min)')))


p2 <- add_trace(p = fig,
                z = z.pred,
                x = seq(2100, 0, by = -100),
                y = seq(0, 30, by = 10),
                type = "surface")
p2

```



### Model Ouput

**All data** 
Distance en temperatuur hoogsignificant

```{r}
model_tempdist_all<-lm(Flighttime_min ~ Distance + Temperature, na.action=na.exclude, data=Flights2_incomplete)
summary(model_tempdist_all)
```



## 4) FlightSpeed vs Height

### Graphs

```{r warning=FALSE}
plot10<-ggplot(Flights2_incomplete, aes(x=Height, y=FlightSpeed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot11<-ggplot(Shortind2_incomplete, aes(x=Height, y=FlightSpeed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot12<-ggplot(Shortpot2_incomplete, aes(x=Height, y=FlightSpeed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot10, plot11, plot12 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)

```

### Model Ouput

**All data** 
Hoogsignificant

```{r}
model_height_all<-lm(FlightSpeed ~ Height, na.action=na.exclude, data=Flights2_incomplete)
summary(model_height_all)
```



## 5) Flight time vs Distance + Height

### Graphs

Height = height of the nest

```{r}
x <- Flights2_incomplete$Distance
y <- Flights2_incomplete$Height
z <- Flights2_incomplete$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 40, phi = 15, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Height", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Height")
```

### Model Output

**All data**

```{r}
model_distheight_all<-lm(Flighttime_min ~ Distance + Height , na.action=na.exclude, data=Flights2_incomplete)
summary(model_distheight_all)
```

Height effect blijkt toch significant. In de negatieve zin weliswaar.
Hoe hoger het nest hoe minder lang hij erover doet. Zou het omgekeerde
verwachten..

**Voorstel: Model volgens Pythagoras?** Hoogsignificant
```{r}
model_distheight2_all<-lm(Flighttime_min ~ sqrt(I(Distance^2) + I(Height^2)) , na.action=na.exclude, data=Flights2_incomplete)
summary(model_distheight2_all)
```




## 6) FlightSpeed vs Cloudcoverage

### Graphs

```{r warning=FALSE}
plot13<-ggplot(Flights2_incomplete, aes(x=Cloudcoverage, y=FlightSpeed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot14<-ggplot(Shortind2_incomplete, aes(x=Cloudcoverage, y=FlightSpeed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot15<-ggplot(Shortpot2_incomplete, aes(x=Cloudcoverage, y=FlightSpeed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot13, plot14, plot15 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```


### Model Ouput

**All data** 
Hoogsignificant

```{r}
model_cloud_all<-lm(FlightSpeed ~ Cloudcoverage, na.action=na.exclude, data=Flights2_incomplete)
summary(model_cloud_all)
```


## 7) FlightSpeed vs Weight individual

### Graphs

```{r warning=FALSE}
plot16<-ggplot(Flights2_incomplete, aes(x=Weight_ind, y=FlightSpeed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot17<-ggplot(Shortind2_incomplete, aes(x=Weight_ind, y=FlightSpeed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot18<-ggplot(Shortpot2_incomplete, aes(x=Weight_ind, y=FlightSpeed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot16, plot17, plot18 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

### Model Output

**All data** 
Niet significant

```{r}
model_weight_all<-lm(FlightSpeed ~ Weight_ind, na.action=na.exclude, data=Flights2_incomplete)
summary(model_weight_all)
```



## 8.1) FlightSpeed vs Windspeed

### Graphs

Telkens voor de modellen 
FlightSpeed \~ Windspeed 
FlightSpeed \~ WindspeedÂ²

```{r warning=FALSE}
plot19<-ggplot(Flights2_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot20<-ggplot(Shortind_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot21<-ggplot(Shortpot_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot22<-ggplot(Flights2_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot23<-ggplot(Shortind_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot24<-ggplot(Shortpot_incomplete, aes(x=Windspeed, y=FlightSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ I(x^2),  se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot19, plot20, plot21, plot22, plot23, plot24 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 3, nrow = 2)
```

### Model Output

**All data** 
Beide modellen significant

```{r}
model_wind_all<-lm(FlightSpeed ~ Windspeed, na.action=na.exclude, data=Flights2_incomplete)
summary(model_wind_all)

model_wind2_all<-lm(FlightSpeed ~ I(Windspeed^2), na.action=na.exclude, data=Flights2_incomplete)
summary(model_wind2_all)
```



## 8.2) FlightSpeed vs Windspeed \| afhankelijk van de windrichting

Hiervoor werd telkens voor elke meting nagegaan of de hoornaar met
meewind (tailwind), tegenwind (upwind) of loodrechte wind
(perpendicular) te maken had. Dit volgens de formules:

\|ðœƒflight âˆ’ðœƒwind\| â‰¤ 45 is tailwind

45 \< \|ðœƒflight âˆ’ðœƒwind\|\<135 is (quasi) perpendicular

\|ðœƒ flight âˆ’ðœƒwind\| â‰¥135 upwind


**Voorstel**
Misschien kan tik egenwind en meewind samenvoegen aangezien de hoornaar telkens heen en terug vliegt?

### Graphs

```{r}
ggplot(data=subset(Flights2_incomplete, !is.na(Wind)), aes(x= Wind, col=Wind, y=FlightSpeed)) + geom_boxplot()

ggplot(data=subset(Flights2_incomplete, !is.na(Wind)), aes(x= Windspeed, col=Wind, y=FlightSpeed)) + geom_point() + facet_grid(~Wind) + geom_smooth(method="lm", formula = y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95)

```


### Model Output


```{r}
data_tailwind<-Flights2_incomplete %>%  filter(Wind!="tailwind")
data_perpendicular<-Flights2_incomplete %>%  filter(Wind!="perpendicular")
data_upwind<-Flights2_incomplete %>%  filter(Wind!="upwind")

model_tailwind<-lm(FlightSpeed ~ I(Windspeed^2), na.action=na.exclude, data=data_tailwind)
summary(model_tailwind)

model_perpendicular<-lm(FlightSpeed ~ I(Windspeed^2), na.action=na.exclude, data=data_perpendicular)
summary(model_perpendicular)

model_upwind<-lm(FlightSpeed ~ I(Windspeed^2), na.action=na.exclude, data=data_upwind)
summary(model_upwind)
```


## 9) Flight error vs urbanisation (25m, 50m, 100m)

Flight error is the difference between the actual angle from the bait to
the nest and the flight direction I measured.

### Graphs

#### Urbanisatiecirkels

```{r}
plot25<-ggplot(data=Flights2_incomplete, aes(x=Urbanisation25m, y=FlightError)) + geom_point() + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95) + ggtitle("Urbanisation circles 25m")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot26<-ggplot(data=Flights2_incomplete, aes(x=Urbanisation50m, y=FlightError)) + geom_point()+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95) + ggtitle("Urbanisation circles 50m")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot27<-ggplot(data=Flights2_incomplete, aes(x=Urbanisation100m, y=FlightError)) + geom_point()+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95) + ggtitle("Urbanisation circles 100m")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot25, plot26, plot27 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```



```{r}
library(circular)
Errorcirc<-circular(Flights2_incomplete$FlightError, type=c("angles"), units=c("degrees"), rotation=c("clock"), zero=0)

lm.circular(Errorcirc, Flights2_incomplete$Urbanisation25m, type=c("c-l"), init=c(1))
```

Moet ik 1 invullen bij init? "a vector with initial values of length
equal to the columns of x"

```{r}
lm.circular(Errorcirc, Flights2_incomplete$Urbanisation50m, type=c("c-l"), init=c(1))
```

Niet significant

```{r}
lm.circular(Errorcirc, Flights2_incomplete$Urbanisation100m, type=c("c-l"), init=c(1))

```

Significant

#### Urbanisatietrajecten

```{r}
plot28<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject25m, y=FlightError)) + geom_point(col="hotpink1") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

plot29<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject50m, y=FlightError)) + geom_point(col="hotpink1") + geom_smooth(method="lm", formula =y ~ x , se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

plot30<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject100m, y=FlightError)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

ggarrange(plot28, plot29, plot30 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

## 10) FlightSpeed vs Urbanisation

### Graphs

Urbanisatiecirkels niet berekend, meteen trajecten genomen want die zijn
betere maatstaf

#### Alle data

```{r}
plot31<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject25m, y=FlightSpeed)) + geom_point(col="slateblue1") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="slateblue4")
               
plot32<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject50m, y=FlightSpeed)) + geom_point(col="slateblue1") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="slateblue4")

plot33<-ggplot(data=subset(Flights2_incomplete, !is.na(Observer)), aes(x=Traject100m, y=FlightSpeed)) + geom_point(col="slateblue1") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="slateblue4")

ggarrange(plot31, plot32, plot33 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

#### Shortest per individual

```{r}
plot34<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Traject25m, y=FlightSpeed)) + geom_point(col="lemonchiffon3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="lemonchiffon4")
               
plot35<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Traject50m, y=FlightSpeed)) + geom_point(col="lemonchiffon3") +
geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="lemonchiffon4")

plot36<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Traject100m, y=FlightSpeed)) + geom_point(col="lemonchiffon3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="lemonchiffon4")

ggarrange(plot34, plot35, plot36 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```


### Model Output

**All data**

```{r}
model_urb25_all<-lm(FlightSpeed ~ Traject25m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_urb25_all)

model_urb50_all<-lm(FlightSpeed ~ Traject50m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_urb50_all)

model_urb100_all<-lm(FlightSpeed ~ Traject100m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_urb100_all)
```

**Shortest per individual**

```{r}
model_urb25_ind<-lm(FlightSpeed ~ Traject25m, na.action=na.exclude, data=Shortind_incomplete)
summary(model_urb25_ind)

model_urb50_ind<-lm(FlightSpeed ~ Traject50m, na.action=na.exclude, data=Shortind_incomplete)
summary(model_urb50_ind)

model_urb100_ind<-lm(FlightSpeed ~ Traject100m, na.action=na.exclude, data=Shortind_incomplete)
summary(model_urb100_ind)
```


## 11) Flight time vs Distance + Temperatuur + Urbanisation

Aangezien temperatuur en urbanisatie de beste predictoren zijn kunnen we
ze eens samen in een model steken.

```{r}
model_1_all<-lm(Flighttime_min ~ Distance + Temperature + Traject25m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_1_all)

model_2_all<-lm(Flighttime_min ~ Distance + Temperature + Traject50m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_2_all)

model_3_all<-lm(Flighttime_min ~ Distance + Temperature + Traject100m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_3_all)
```


## 12) FlightSpeed vs Temperatuur + Urbanisation

```{r}
x <- Flights2_incomplete$Temperature
y <- Flights2_incomplete$Traject100m
z <- Flights2_incomplete$FlightSpeed

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 210, phi = 10, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Temperature", ylab = "Urbanisation (Traject100m)", zlab = "Flight Speed", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight Speed vs Temperature + Urbanisation")
```

```{r}
model_4_all<-lm(FlightSpeed ~ Temperature + Traject25m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_4_all)

model_5_all<-lm(FlightSpeed ~ Temperature + Traject50m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_5_all)

model_6_all<-lm(FlightSpeed ~ Temperature + Traject100m, na.action=na.exclude, data=Flights2_incomplete)
summary(model_6_all)
```

## Varpart

library(vegan)
varpart(Flights2_incomplete$Flighttime_min, ~Distance, ~Temperatuur, ~Windspeed, na.action=na.exclude, data= Flights2_incomplete)
**Probleem met NA**





**TO DO** - circulaire statistiek verder uitwerken ?





## Statistische modellen probeersels

```{r}
# Model kiezen
library(car)
library(carData)
library(leaps)
select1<-regsubsets(FlightSpeed ~ Temperature + Cloudcoverage + I(Windspeed^2) + Weight_ind + Traject100m, na.action=na.exclude, data=Flights2_incomplete, nbest=3)
summary(select1)
plot(select1, scale="adjr2")

select2<-regsubsets(FlightSpeed ~ Temperature + Cloudcoverage + Windspeed + Weight_ind + Traject100m +
Traject100m*Temperature + Traject100m*Cloudcoverage + Traject100m*Windspeed + Traject100m*Weight_ind + Temperature*Cloudcoverage + Temperature*Windspeed + Temperature*Weight_ind + Cloudcoverage*Windspeed + Cloudcoverage*Weight_ind + Windspeed*Weight_ind, na.action=na.exclude, data=Flights2_incomplete, nbest=3)
summary(select2)
plot(select2, scale="adjr2")
```


## Multicollinearity check

```{r}
library(ggcorrplot)
library(car)

datacor<-Flights2_incomplete[, c("Temperature", "Cloudcoverage", "Windspeed", "Weight_ind", "Traject100m")]
source("~/GitHub/vespa_analyses/Input/HighstatLibV10.R") 
corvif(datacor)

cormat <- round(cor(datacor, use = "pairwise.complete.obs"), 2)
ggcorrplot(cormat, lab= TRUE, type = "lower", ggtheme = ggplot2::theme_gray,
   colors = c("#6D9EC1", "white", "#E46726"))
```



```{r}
plot(Temperature~Traject100m, data=Flights2_incomplete)
```


Eerder toeval dat Temperature en Traject100m gecorreleeerd zijn?


##PCA

```{r}
library(vegan)
library(missMDA)
library(FactoMineR)
datapca<-select(Flights2_incomplete, Cloudcoverage, Windspeed, Temperature, Weight_ind, Traject100m)
nb <- estim_ncpPCA(datapca, scale = TRUE)
comp<-imputePCA(datapca, ncp=2)
res<-PCA(comp$completeObs)
```
