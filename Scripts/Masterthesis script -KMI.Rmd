---
title: "Masterthesis script,weerparameters KMI "
author: "Heleen Van Ransbeeck"
date: "2023-02-27"
output:
  html_document: default
  pdf_document: default
---

# Data inladen

```{r}
KMIdata<-read.table(file = "~/GitHub/vespa_analyses/Input/KMIdata.txt", header=TRUE, sep="\t")

library(dplyr)
library(ggplot2)
library(ggpubr)
```




Volgende datasets zijn gecreëerd:

- KMIdata: dataset met alle vliegtijden en parameters (KMI)

Voor het model: *Flight time ~ Distance*
gebruiken we de dataset vliegtijden per individu
Omdat we hiermee de theoretische regel 1min=100m kunnen verifiëren.
De imkers nemen hiervoor altijd kortste meting

Voor modellen met *weerparameters, gewicht, urbanisatie*:
Hiervoor nemen we telkens de hele dataset, omdat elke meting van deze 
factoren afhangt.


**Outlier van nest 29, Bait 1, Individu A weggelaten in deze dataset. (600m op 2min lijkt wel heel snel)**

**Outlier van Melle ook weggelaten (meting op 2 km niet betrouwbaar)**

**Meting in Excel script wel nog terug te vinden.**







# 1.1) ForagingSpeed vs Temperature

## Graphs

Van temperatuur ook categorische variabele maken (aanraden van Prof.Vangestel)

```{r}
KMIdata$Temperature_cat<-cut(KMIdata$Temperature, c(8,13,17,21,25,29,33))
ggplot(data=subset(KMIdata, !is.na(Temperature_cat)), aes(x=Temperature_cat)) + geom_bar(fill="lightcoral")
```


```{r echo=FALSE, warning=FALSE}
ggplot(KMIdata, aes(x=Temperature_KMI, y=ForagingSpeed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("All data KMI")+ theme(plot.title = element_text(hjust = 0.5, size=10))

```

## Model Output


### Distance = offset

1) Temperature = continuous variable

- Significant

- Normality niet ok!


2) Temperature = discrete variable

- Een aantal klassen significant, interpretatie?

- Normality niet ok!


```{r}
library(lmerTest)
library(lme4)

model_temp_cont<-lmer(Flighttime_min ~ Temperature_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_temp_cont)
res<-residuals(model_temp_cont)
shapiro.test(res)
qqnorm(res)
qqline(res)


model_temp_cat<-lmer(Flighttime_min ~ Temperature_cat + (1|Individualcode), offset=Distance, data=KMIdata)
summary(model_temp_cat)
anova(model_temp_cat, ddf="Satterthwaite", type=3)
res<-residuals(model_temp_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual = random

1) Temperature = continuous variable

- Niet significant

- Normality niet ok!


2) Temperature = discrete variable

- Niet significant

- Normality niet ok!

```{r}
model_temp_cont<-lmer(ForagingSpeed ~ Temperature_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_temp_cont)
res<-residuals(model_temp_cont)
shapiro.test(res)
qqnorm(res)
qqline(res)


model_temp_cat<-lmer(ForagingSpeed ~ Temperature_cat + (1|Individualcode), data=KMIdata)
summary(model_temp_cat)
anova(model_temp_cat, ddf="Satterthwaite", type=3)
res<-residuals(model_temp_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)

```


### Foragingspeed vs temperature | individual, wiekpot & nest = random

1) Temperature = continuous variable

- Significant

- Normality niet ok!


2) Temperature = discrete variable

- 1 klasse significant, interpretatie?

- Normality niet ok!

```{r}
model_temp_cont<-lmer(ForagingSpeed ~ Temperature_KMI + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_temp_cont)
res<-residuals(model_temp_cont)
shapiro.test(res)
qqnorm(res)
qqline(res)


model_temp_cat<-lmer(ForagingSpeed ~ Temperature_cat + (1|Individualcode) + (1|Baitcode) + (1|NestID), data=KMIdata)
summary(model_temp_cat)
anova(model_temp_cat, ddf="Satterthwaite", type=3)
res<-residuals(model_temp_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)

```









# 1.2) Flight time vs Distance + Temperature

## Graph

**VRAAG: Kan dit ook met mixed model?**

```{r}
library(knitr)
library(kableExtra)
library("plot3D")

x <- KMIdata$Distance
y <- KMIdata$Temperature_KMI
z <- KMIdata$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 210, phi = 10, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Temperature", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Temperature")
```











# 2) ForagingSpeed vs Cloudcoverage

## Graphs

```{r warning=FALSE}
ggplot(KMIdata, aes(x=Cloudcoverage_KMI, y=ForagingSpeed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("All data KMI")+ theme(plot.title = element_text(hjust = 0.5, size=10))
```


## Model Ouput


### Distance = offset

- Licht significant

- Normality niet ok!

```{r}
model_cloud_all<-lmer(Flighttime_min ~ Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_cloud_all)
anova(model_cloud_all, ddf="Satterthwaite", type=3)

res<-residuals(model_cloud_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual = random

- Niet significant

- Normality niet ok!

```{r}
model_cloud_all<-lmer(ForagingSpeed ~ Cloudcoverage_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_cloud_all)
anova(model_cloud_all, ddf="Satterthwaite", type=3)

res<-residuals(model_cloud_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Licht significant

- Normality niet ok!

```{r}
model_cloud_all<-lmer(ForagingSpeed ~ Cloudcoverage_KMI + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_cloud_all)
anova(model_cloud_all, ddf="Satterthwaite", type=3)

res<-residuals(model_cloud_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```











# 3.1) ForagingSpeed vs Windspeed

## Graphs

Telkens voor de modellen: 

ForagingSpeed \~ Windspeed 

ForagingSpeed \~ Windspeed²

```{r warning=FALSE}
plot19<-ggplot(KMIdata, aes(x=WindSpeed_KMI, y=ForagingSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("ForagingSpeed ~ Windspeed  KMI")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot22<-ggplot(KMIdata, aes(x=WindSpeed_KMI, y=ForagingSpeed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("ForagingSpeed ~ Windspeed²  KMI")+ theme(plot.title = element_text(hjust = 0.5, size=10))


ggarrange(plot19, plot22 + rremove("x.text"), 
          labels = c("A", "B"),
          ncol = 2, nrow = 1)
```

## Model Output

### Distabce = offset

- Beide modellen significant

- Normality voor beiden niet ok!

```{r}
model_wind_all<-lmer(Flighttime_min ~ WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_wind_all)
anova(model_wind_all, ddf="Satterthwaite", type=3)
res<-residuals(model_wind_all)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_wind2_all<-lmer(Flighttime_min ~ I(WindSpeed_KMI^2) + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_wind2_all)
anova(model_wind2_all, ddf="Satterthwaite", type=3)
res<-residuals(model_wind2_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```

### Foragingspeed vs temperature | individual = random

- Beide modellen significant

- Normality voor beiden niet ok!

```{r}
model_wind_all<-lmer(ForagingSpeed ~ WindSpeed_KMI + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_wind_all)
res<-residuals(model_wind_all)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_wind2_all<-lmer(ForagingSpeed ~ I(WindSpeed_KMI^2) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_wind2_all)
res<-residuals(model_wind2_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```

### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Beide modellen significant

- Normality voor beiden ok!

```{r}
model_wind_all<-lmer(ForagingSpeed ~ WindSpeed_KMI + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_wind_all)
res<-residuals(model_wind_all)
shapiro.test(res)
qqnorm(res)
qqline(res)

model_wind2_all<-lmer(ForagingSpeed ~ I(WindSpeed_KMI^2) + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_wind2_all)
res<-residuals(model_wind2_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```













# 3.2) ForagingSpeed vs Windspeed \| afhankelijk van de windrichting

**Gezien het grote aantal modellen in deze sectie, even afgewacht om telkens de 3 types modellen toe te passen**

**VRAAG: al deze modellen behouden?**

Hiervoor werd telkens voor elke meting nagegaan of de hoornaar met
meewind (tailwind), tegenwind (upwind) of loodrechte wind
(perpendicular) te maken had. Dit volgens de formules:

\|𝜃flight −𝜃wind\| ≤ 45 is tailwind

45 \< \|𝜃flight −𝜃wind\|\<135 is (quasi) perpendicular

\|𝜃 flight −𝜃wind\| ≥135 upwind


Windrichting werd telkens bepaald t.o.v. de vliegrichting (**Wind_flight**) en t.o.v. richting tot het nest (**Wind_nest**). 

**VRAAG: Welke van de 2 kiezen?**


## Graphs

**TO DO: Lege vakjes Wind_flight NA maken**

```{r}
ggplot(data=subset(KMIdata, !is.na(Wind_flight)), aes(x= Wind_flight, col=Wind_flight, y=ForagingSpeed)) + geom_boxplot()

ggplot(data=subset(KMIdata, !is.na(Wind_flight)), aes(x= WindSpeed_KMI, col=Wind_flight, y=ForagingSpeed)) + geom_point() + facet_grid(~Wind_flight) + geom_smooth(method="lm", formula = y ~ I(x^2), se=TRUE, fullrange=FALSE, level=0.95)

```



## Model Output

### Anova van Foragingspeed en de 3 windinvloeden

- interpretatie?

```{r}
windanova<-lmer(Flighttime_min ~ Wind_flight + (1|Individualcode), offset=Distance, na.action=na.exclude, data=KMIdata)
summary(windanova)

```


### ForagingSpeed vs WindSpeed voor Tailwind dataset

- Significant 

- Normality niet ok!

```{r}
data_tailwind<-subset(KMIdata, Wind_flight == "tailwind")

model_tailwind<-lmer(Flighttime_min ~ WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=data_tailwind)
summary(model_tailwind)
anova(model_tailwind, ddf="Satterthwaite", type=3)

res<-residuals(model_tailwind)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### ForagingSpeed vs WindSpeed voor Perpendicular dataset

- Significant

- Normality niet ok!

```{r}
data_perpendicular<-subset(KMIdata, Wind_flight == "perpendicular")


model_perpendicular<-lmer(Flighttime_min ~ WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=data_perpendicular)
summary(model_perpendicular)
anova(model_perpendicular, ddf="Satterthwaite", type=3)

res<-residuals(model_perpendicular)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### ForagingSpeed vs WindSpeed voor Upwind dataset

- Niet significant

- Normality niet ok!

```{r}
data_upwind<-subset(KMIdata, Wind_flight == "upwind")


model_upwind<-lmer(Flighttime_min ~ WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=data_upwind)
summary(model_upwind)
anova(model_upwind, ddf="Satterthwaite", type=3)

res<-residuals(model_upwind)
shapiro.test(res)
qqnorm(res)
qqline(res)
```














# 4) ForagingSpeed vs Weight individual

## Graphs

```{r warning=FALSE}
ggplot(KMIdata, aes(x=Weight_ind, y=ForagingSpeed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))
```

## Model Output

### Distance = offset

- Niet significant

- Normality ok!

```{r}
model_weight_all<-lmer(Flighttime_min ~ Weight_ind + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_weight_all)
anova(model_weight_all, ddf="Satterthwaite", type=3)

res<-residuals(model_weight_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual = random

- Niet significant

- Normality ok!

```{r}
model_weight_all<-lmer(ForagingSpeed ~ Weight_ind + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_weight_all)
anova(model_weight_all, ddf="Satterthwaite", type=3)
res<-residuals(model_weight_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```

### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Niet significant

- Normality ok!

```{r}
model_weight_all<-lmer(ForagingSpeed ~ Weight_ind + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_weight_all)
anova(model_weight_all, ddf="Satterthwaite", type=3)
res<-residuals(model_weight_all)
shapiro.test(res)
qqnorm(res)
qqline(res)
```










# 5.1) ForagingSpeed vs Urbanisation (Traject 100m)

## Graphs

Urbanisatiecirkels niet berekend, meteen trajecten genomen want die zijn
betere maatstaf.

Telkens vergeleken tussen dataset met en zonder mijn meting bij lage temperatuur 
en hoge urbanisatie in Sint-Amandsberg.

**Verder werken met 100m buffer!**

```{r, fig.width=6, fig.height=4}
# Meting in urbaan gebied met koude temperatuur weglaten (Nest 38 en 39, 3 wiekpotten)

KMIdata2<-KMIdata %>%  filter(Traject100m!=0.504960)
KMIdata2<-KMIdata2 %>%  filter(Traject100m!=0.496950)
KMIdata2<-KMIdata2 %>%  filter(Traject100m!=0.411898)


ggplot(data=subset(KMIdata, !is.na(Observer)), aes(x=Traject100m, y=ForagingSpeed)) + geom_point(col="slateblue1") + geom_abline(intercept=3.8984, slope= -5.3143, color="slateblue4", linewidth=1) + ggtitle("Met outlier") + xlim(0, 0.6)
               
ggplot(data=subset(KMIdata2, !is.na(Observer)), aes(x=Traject100m, y=ForagingSpeed)) + geom_point(col="slateblue1") + geom_abline(intercept=3.7838, slope= -4.0061, color="slateblue4", linewidth=1) + ggtitle("Zonder outlier") + xlim(0, 0.6)
```



## Graph Temperature vs Urbanisation

Correlatie tussen temperatuur en urbanisatie checken.
Duidelijk gecorreleerd. 
Toeval of urban heat island effect?

```{r}
ggplot(data=subset(KMIdata, !is.na(Temperature_cat)), aes(x=Temperature_cat, col=Temperature_cat, y=Traject100m)) + geom_boxplot()
ggplot(data=KMIdata, aes(x=Temperature_KMI, y=Traject100m)) + geom_point()
```



## Model Output


## Met outlier

### Distance = offset

- Hoogsignificant

- Normality niet ok!

```{r}
model_urb1<-lmer(Flighttime_min ~ Traject100m + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)

res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual = random

- Hoogsignificant

- Normality niet ok!

```{r}
model_urb1<-lmer(ForagingSpeed ~ Traject100m + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)

res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```




### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Hoogsignificant

- Normality niet ok!

```{r}
model_urb1<-lmer(ForagingSpeed ~ Traject100m + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)
res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```





## Zonder outlier

### Distance = offset

- Hoogsignificant

- Normality niet ok!

```{r}
model_urb1<-lmer(Flighttime_min ~ Traject100m + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata2)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)

res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual = random

- Hoogsignificant

- Normality niet ok!

```{r}
model_urb1<-lmer(ForagingSpeed ~ Traject100m + (1|Individualcode), na.action=na.omit, data=KMIdata2)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)

res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```




### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Licht significant

- Normality ok!

```{r}
model_urb1<-lmer(ForagingSpeed ~ Traject100m + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata2)
summary(model_urb1)
anova(model_urb1, ddf="Satterthwaite", type=3)
res<-residuals(model_urb1)
shapiro.test(res)
qqnorm(res)
qqline(res)
```






# 5.2) ForagingSpeed vs Urbanisation (Categorisch)

## Graph

```{r}
ggplot(data=KMIdata, aes(x=Urban_EN, y=ForagingSpeed, col=Urban_EN)) + geom_boxplot() 
```


## Model Output

### Distance = offset

- Urban significant, interpretatie?

- Normality niet oke!

```{r}
model_urb_cat<-lmer(Flighttime_min ~ Urban_EN + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata )
summary(model_urb_cat)
res<-residuals(model_urb_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)
```

### Foragingspeed vs temperature | individual = random

- Alles significant

- Normality niet oke!

```{r}
model_urb_cat<-lmer(ForagingSpeed ~ Urban_EN + (1|Individualcode), na.action=na.omit, data=KMIdata )
summary(model_urb_cat)
res<-residuals(model_urb_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)
```


### Foragingspeed vs temperature | individual, wiekpot & nest = random

- Alles significant

- Normality niet oke!

```{r}
model_urb_cat<-lmer(ForagingSpeed ~ Urban_EN + (1|Individualcode) + (1|Baitcode) + (1|NestID), na.action=na.omit, data=KMIdata )
summary(model_urb_cat)
res<-residuals(model_urb_cat)
shapiro.test(res)
qqnorm(res)
qqline(res)
```










# 6) Flight error vs urbanisation

Flight error is the difference between the actual angle from the bait to
the nest and the flight direction I measured.


## Graphs

```{r}
ggplot(data=KMIdata, aes(x=Traject100m, y=FlightError)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")
```


## Model Output

 - Niet significant
 
 - Normality niet ok!

```{r}
model_errurb100<-lmer(FlightError ~ Traject100m + (1|NestID) + (1|NestID:BaitID) + (1|Individualcode), na.action=na.omit, data=KMIdata)
summary(model_errurb100)
anova(model_errurb100, ddf="Satterthwaite", type=3)

res<-residuals(model_errurb100)
shapiro.test(res)
qqnorm(res)
qqline(res)
```










# 7) Foragingspeed vs Flight error


```{r}
ggplot(data=KMIdata, aes(x=FlightError, y=ForagingSpeed)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")
```












# Model Selection

**Zonder interacties | Temperatuur als continue variabele**

  - Urbanisatie en Temperatuur komen naar voor als beste predictoren
  
  - Estimate van Urbanisatie is super groot?? Klopt iets niet
  
  - ook Individual variance is super groot
  
```{r}
fullmodel1<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(fullmodel1)

model1<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model1)

model2<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model2)

model3<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI + Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model3)

model4<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI  + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model4)
```



**Zonder interacties | Temperatuur als categorische variabele**

  - Urbanisatie en Windspeed komen naar voor als beste predictoren
  
  
```{r}
fullmodel2<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Cloudcoverage_KMI + Weight_ind + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(fullmodel2)

model5<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model5)

model6<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI + WindSpeed_KMI + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model6)

model7<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI + WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model7)

model8<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI  + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model8)
```


**Met interacties | Temperatuur als continue variabele**

Volgende interacties werden toegevoegd met bijhorende verantwoording voor de keuze


  - Urbanisatie * Temperatuur   : urban heat island effect?
  
  - Urbanisatie * WindSpeed     : Lagere windsnelheden gemeten tussen de gebouwen?
  
  - Urbanisatie * Weight_ind    : Meer / minder resources in de stad en dus effect op gewicht van de werksters
  
  - Temperatuur * Cloudcoverage : Koudere temperatuur gemeten bij hogere bewolking
  


Tussen model 12 en 13 gebeurt er iets raars.

Urbanisatie en windspeed komen terug naar voor.

```{r}
fullmodel3<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*Temperature_KMI + Traject100m*WindSpeed_KMI + Traject100m*Weight_ind + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(fullmodel3)

model9<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*WindSpeed_KMI + Traject100m*Weight_ind + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model9)

model10<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*WindSpeed_KMI + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model10)

model11<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Weight_ind + Traject100m*WindSpeed_KMI + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model11)

model12<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Traject100m*WindSpeed_KMI + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model12)

model13<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + Traject100m*WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model13)

model14<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model14)

model15<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model15)

model16<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model16)
```


**Met interacties | Temperatuur als categorische variabele**

Dezelfde interacties als hierboven werden toegevoegd.
  

```{r}
fullmodel4<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*Temperature_cat + Traject100m*WindSpeed_KMI + Traject100m*Weight_ind + Temperature_cat*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(fullmodel4)

model17<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*Temperature_cat + Traject100m*WindSpeed_KMI + Traject100m*Weight_ind + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model17)

model18<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*WindSpeed_KMI + Traject100m*Weight_ind + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model18)

model19<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Cloudcoverage_KMI + Weight_ind + Wind_flight + Traject100m*WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model19)

model20<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat  + Weight_ind + Wind_flight + Traject100m*WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model20)

model21<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_cat + Weight_ind + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model21)

model22<-lmer(Flighttime_min ~ Traject100m + Temperature_cat +  Weight_ind + Wind_flight +(1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model22)

model23<-lmer(Flighttime_min ~ Traject100m  + Temperature_cat + Wind_flight + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model23)

model24<-lmer(Flighttime_min ~ Traject100m +Temperature_cat+ (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(model24)
```


# Probeersels
```{r}
probeersel1<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI +  Traject100m*Temperature_KMI + Traject100m*WindSpeed_KMI + Temperature_KMI*Cloudcoverage_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(probeersel1)

probeersel2<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI + Cloudcoverage_KMI +  Traject100m*Temperature_KMI + Traject100m*WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(probeersel2)

probeersel3<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI +  Traject100m*Temperature_KMI + Traject100m*WindSpeed_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(probeersel3)

probeersel4<-lmer(Flighttime_min ~ Traject100m + WindSpeed_KMI + Temperature_KMI +  Traject100m*Temperature_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(probeersel4)

probeersel5<-lmer(Flighttime_min ~ Traject100m + Temperature_KMI +  Traject100m*Temperature_KMI + (1|Individualcode), offset=Distance, na.action=na.omit, data=KMIdata)
summary(probeersel5)
```


# AIC check

```{r}
library(AICcmodavg)
models<-list(fullmodel1, model1, model2, model3, model4, model5, model6, model7, model8, fullmodel3, model9, model10, model11, model12, model12, model13, model14, model15, model16, fullmodel4, model17, model18, model19, model20, model21, model22, model23, model24, probeersel1, probeersel2, probeersel3, probeersel4, probeersel5 )

mod.names<-c('fullmodel1', 'model1', 'model2', 'model3', 'model4', 'fullmomdel2', 'model5', 'model6', 'model7', 'model8', 'fullmodel3', 'model9', 'model10', 'model11', 'model12', 'model13', 'model14', 'model15', 'model16', 'fullmodel4', 'model17', 'model18', 'model19', 'model20', 'model21', 'model22', 'model23', 'model24', 'probeersel1', 'probeersel2', 'probeersel3', 'probeersel4', 'probeersel5')
aictab(cand.set = models, modnames = mod.names)
```



# Multicollinearity check

**PROBLEEM: wanneer ik wil checken voor Baitcode en Individualcode krijg ik foutmelding**

**Hoe kan ik dan een covariantie uitvoeren tussen discrete variabelen?**

```{r}
library(ggcorrplot)
library(car)

datacor<-KMIdata[ , c("Temperature_KMI", "Cloudcoverage_KMI", "WindSpeed_KMI", "Weight_ind", "Traject100m", "NestID")]
source("~/GitHub/vespa_analyses/Input/HighstatLibV10.R") 
corvif(datacor)

cormat <- round(cor(datacor, use = "pairwise.complete.obs"), 2)
ggcorrplot(cormat, lab= TRUE, type = "lower", ggtheme = ggplot2::theme_gray,
   colors = c("#6D9EC1", "white", "#E46726"))
```

