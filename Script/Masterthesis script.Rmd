---
title: "Masterthesis script"
author: "Heleen Van Ransbeeck"
date: '2023-01-03'
output:
  html_document: default
  word_document: default
---
# Data inladen
```{r}
setwd("~/GitHub/vespa_analyses/Input")

Baits<-read.table(file = "Baits_useful.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Flights_incomplete<-read.table(file = "Flights_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Nests<-read.table(file = "Nests_useful.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Shortind_incomplete<-read.table(file = "Shortind_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Shortpot_incomplete<-read.table(file = "Shortpot_incomplete.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

Individuals<-read.table(file = "Individuals.txt", header=TRUE, sep="\t", na.strings=c(""," ","NA"))

```

-incomplete wil zeggen dat de weergegeves nog niet volledig zijn. Ik wacht hiervoor op het KMI.


# Aanpassingen datasets
```{r}
# Overbodige kolommen wegdoen, foutje in excel
Flights_incomplete<-Flights_incomplete[1:(length(Flights_incomplete)-2)]
Shortind_incomplete<-Shortind_incomplete[1:(length(Shortind_incomplete)-2)]
Shortpot_incomplete<-Shortpot_incomplete[1:(length(Shortpot_incomplete)-2)]

#Snelheid (m/s) toevoegen aan tabel
Flights_incomplete$Speed<-Flights_incomplete$Distance/(Flights_incomplete$Flighttime_min*60)
Shortind_incomplete$Speed<-Shortind_incomplete$Distance/(Shortind_incomplete$Flighttime_min*60)
Shortpot_incomplete$Speed<-Shortpot_incomplete$Distance/(Shortpot_incomplete$Flighttime_min*60)

# Procent symbolen cloudcoverage vervangen door komma getallen
Flights_incomplete$Cloudcoverage<- as.numeric(sub("%", "",Flights_incomplete$Cloudcoverage,fixed=TRUE))/100
Shortind_incomplete$Cloudcoverage<- as.numeric(sub("%", "",Shortind_incomplete$Cloudcoverage,fixed=TRUE))/100
Shortpot_incomplete$Cloudcoverage<- as.numeric(sub("%", "",Shortpot_incomplete$Cloudcoverage,fixed=TRUE))/100

## Urbanisatiecirkels per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortpot_incomplete<-merge(Shortpot_incomplete, Baits[, c("NestID", "BaitID", "Urbanisation25m", "Urbanisation50m", "Urbanisation100m")], by=c("NestID", "BaitID"), all=TRUE)

## Urbanisatietrajecten per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"), all=TRUE)
Shortpot_incomplete<-merge(Shortpot_incomplete, Baits[, c("NestID", "BaitID", "Traject25m", "Traject50m", "Traject100m")], by=c("NestID", "BaitID"), all=TRUE)

## Gewicht individu per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Individuals[, c("NestID", "BaitID","ColorInd", "Weight_ind")], by=c("NestID", "BaitID", "ColorInd"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Individuals[, c("NestID", "BaitID", "ColorInd", "Weight_ind")], by=c("NestID", "BaitID", "ColorInd"), all=TRUE)
Shortpot_incomplete<-merge(Shortpot_incomplete, Individuals[, c("NestID", "BaitID", "ColorInd","Weight_ind")], by=c("NestID", "BaitID", "ColorInd"), all=TRUE)

## Nesthoogte per vliegtijd toevoegen
Flights_incomplete<-merge(Flights_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"), all=TRUE)
Shortind_incomplete<-merge(Shortind_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"), all=TRUE)
Shortpot_incomplete<-merge(Shortpot_incomplete, Nests[, c("NestID", "Height")], by=c("NestID"), all=TRUE)

```


# Datapunten op 2km weglaten?
Deze metingen zijn nogal onzeker omdat deze waarnemingen ook van een ander nest kunnen komen.
Was op 2km afstand en in Melle zijn toch redelijk wat nesten gevonden. Kans dat het van een nest is dat niet gevonden werd is groot.

Als de website van Vespawatch in orde is kan ik kijken of er eventueel een nest in de buurt is gevonden.

```{r}
library(dplyr)
Flights2_incomplete<-Flights_incomplete %>%  filter(NestID!=1)
Shortind2_incomplete<-Shortind_incomplete %>%  filter(NestID!=1)
Shortpot2_incomplete<-Shortpot_incomplete %>%  filter(NestID!=1)
```



# Data exploratie

## 1) Flight time vs distance

### Graphs 

Grafieken met en zonder outliers telkens voor de volgende datasets
 - volledige dataset
 - enkel kortste vliegtijden per individu
 - enkel kortste vliegtijden per wiekpot

Oranje lijn stelt de theoretische regel "1min vliegtijd is 100m tot het nest" voor.
 
```{r echo=FALSE, warning=FALSE}
library(ggplot2)
library(ggpubr)

plot1<-ggplot(Flights_incomplete, aes(x=Distance, y=Flighttime_min)) + geom_point(color="aquamarine3", size=0.9) + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan") +  ggtitle("All data | outliers incl")+ theme(plot.title = element_text(hjust = 0.5, size=10))


plot2<-ggplot(Flights2_incomplete, aes(x=Distance, y=Flighttime_min)) + geom_point(color="aquamarine3", size=0.9) + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan")+  ggtitle("All data| outliers excl")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot3<-ggplot(Shortind_incomplete, aes(x=Distance, y=Flighttime_min)) + geom_point(color="aquamarine3", size=0.9)  + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan") +  ggtitle("Shortest per ind. | outliers incl")+ theme(plot.title = element_text(hjust = 0.5, size=10))


plot4<-ggplot(Shortind2_incomplete, aes(x=Distance, y=Flighttime_min)) + geom_point(color="aquamarine3", size=0.9)  + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan") +  ggtitle("Shortest per ind. | outliers excl")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot5<-ggplot(Shortpot_incomplete, aes(x=Distance, y=Flighttime_min))  + geom_point(color="aquamarine3",size=0.9)  + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan") + ggtitle("Shortest per jar | outliers incl")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot6<-ggplot(Shortpot2_incomplete, aes(x=Distance, y=Flighttime_min))  + geom_point(color="aquamarine3", size=0.9)  + geom_abline(intercept=0, slope=0.01, color="darkorange2", linewidth=0.8) + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkcyan") +  ggtitle("Shortest per jar | outliers excl")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot1, plot3, plot5, plot2, plot4, plot6 + rremove("x.text"), 
          labels = c("A", "B", "C", "D", "E", "F"),
          ncol = 3, nrow = 2)
```

De datapunten uit Melle hebben duidelijk een groot effect op de regressielijn. Ze wijkt meer af van de theoretische oranje lijn. 

### Model Output

**All data**
```{r}
# outliers incl
model_dist_all<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Flights_incomplete)
summary(model_dist_all)

# outliers excl
model_dist_all2<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Flights2_incomplete)
summary(model_dist_all2)
```

Beide hoog significant

```{r}
# Mixed model, Observer, Nest en Individuele variatie in rekening brengen
library(lmerTest)
library(lme4)
Flights_incomplete$NestID<-as.factor(Flights_incomplete$NestID)
Flights_incomplete$BaitID<-as.factor(Flights_incomplete$BaitID)
Flights_incomplete$ColorInd<-as.factor(Flights_incomplete$ColorInd)

mixedobserver<-lmer(Flighttime_min ~ Distance + (1|Observer) + (1|NestID) + (1|ColorInd:BaitID:NestID), data=Flights_incomplete)
summary(mixedobserver)
anova(mixedobserver, ddf="Satterthwaite", type=3)
```

Variatie tussen de waarnemers bleek niet groot te zijn (0).

**Shortest per individual**
```{r}
# outliers incl
model_dist_ind<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Shortind_incomplete)
summary(model_dist_ind)

# outliers excl
model_dist_ind2<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Shortind2_incomplete)
summary(model_dist_ind2)
```

Beide hoogsignificant

**Shortest per jar**
```{r}
# outliers incl
model_dist_pot<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_dist_pot)

# outliers excl
model_dist_pot2<-lm(Flighttime_min ~ Distance, na.action=na.exclude, data=Shortpot2_incomplete)
summary(model_dist_pot2)
```

Beide hoogsignificant



## 2) Speed vs Temperature

### Graphs 

Grafieken met outliers telkens voor de volgende datasets
 - volledige dataset
 - enkel kortste vliegtijden per individu
 - enkel kortste vliegtijden per wiekpot
 
```{r echo=FALSE, warning=FALSE}
plot7<-ggplot(Flights_incomplete, aes(x=Temperature, y=Speed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot8<-ggplot(Shortind_incomplete, aes(x=Temperature, y=Speed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot9<-ggplot(Shortpot_incomplete, aes(x=Temperature, y=Speed)) + geom_point(color="lightcoral") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="orangered3") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot7, plot8, plot9 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

### Model Output

**All data**
```{r}
model_temp_all<-lm(Speed ~ Temperature, na.action=na.exclude, data=Flights_incomplete)
summary(model_temp_all)
```
Hoogsignificant

**Shortest per individual**
```{r}
model_temp_ind<-lm(Speed ~ Temperature, na.action=na.exclude, data=Shortind_incomplete)
summary(model_temp_ind)
```
Hoogsignificant

**Shortest per jar**
```{r}
model_temp_pot<-lm(Speed ~ Temperature, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_temp_pot)
```
Minder significant



## 3) Flight time vs Distance + Temperature

## Graph

With all data, outliers included

```{r}
library(knitr)
library(kableExtra)
library("plot3D")

x <- Flights2_incomplete$Distance
y <- Flights2_incomplete$Temperature
z <- Flights2_incomplete$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 40, phi = 0, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Temperature", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Temperature")
```

### Model Ouput

**All data**
```{r}
model_tempdist_all<-lm(Flighttime_min ~ Distance + Temperature, na.action=na.exclude, data=Flights_incomplete)
summary(model_tempdist_all)
```
Beide Hoogsignificant

**Shortest per individual**
```{r}
model_tempdist_ind<-lm(Flighttime_min ~ Distance + Temperature, na.action=na.exclude, data=Shortind_incomplete)
summary(model_tempdist_ind)
```
Temperatuur niet significant

**Shortest per jar**
```{r}
model_tempdist_pot<-lm(Flighttime_min ~ Distance + Temperature, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_tempdist_pot)
```
Temperatuur niet significant



## 4) Speed vs Height

### Graphs

```{r warning=FALSE}
plot10<-ggplot(Flights_incomplete, aes(x=Height, y=Speed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot11<-ggplot(Shortind_incomplete, aes(x=Height, y=Speed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot12<-ggplot(Shortpot_incomplete, aes(x=Height, y=Speed)) + geom_point(color="burlywood3") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="chocolate4") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot10, plot11, plot12 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)

```

### Model Ouput

**All data**
```{r}
model_height_all<-lm(Speed ~ Height, na.action=na.exclude, data=Flights_incomplete)
summary(model_height_all)
```
Hoogsignificant

**Shortest per individual**
```{r}
model_height_ind<-lm(Speed ~ Height, na.action=na.exclude, data=Shortind_incomplete)
summary(model_height_ind)
```
Niet significant

**Shortest per jar**
```{r}
model_height_pot<-lm(Speed ~ Height, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_height_pot)
```
Niet significant



## 5) Flight time vs Distance + Height

### Graphs

Height = height of the nest

```{r}
x <- Flights2_incomplete$Distance
y <- Flights2_incomplete$Height
z <- Flights2_incomplete$Flighttime_min

fit <- lm(z ~ x + y, na.action=na.exclude)
x.pred <- seq(min(x[!is.na(x)]), max(x[!is.na(x)]), length.out = 20)
y.pred <- seq(min(y[!is.na(y)]), max(y[!is.na(y)]), length.out = 20)
xy <- expand.grid( x = x.pred, y = y.pred)
z.pred <- matrix(predict(fit, newdata = xy), 
                 nrow = 20, ncol = 20)
fitpoints <- predict(fit)

scatter3D(x, y, z, pch = 19, cex = 0.6, colvar=FALSE, col="dodgerblue3", theta = 40, phi = 15, bty="u", col.panel ="grey93", expand =0.4, col.grid = "white", xlab = "Distance", ylab = "Height", zlab = "Flight time", surf = list(x = x.pred, y = y.pred, z = z.pred,  
facets = TRUE, col=ramp.col(col = c("dodgerblue4", "seagreen2"), n = 100, alpha=0.8), fit = fitpoints, border="black"),main = "Flight time vs Distance + Height")
```

### Model Output

**All data**
```{r}
model_distheight_all<-lm(Flighttime_min ~ Distance + Height , na.action=na.exclude, data=Flights_incomplete)
summary(model_distheight_all)
```

Height effect blijkt toch significant. In de negatieve zin weliswaar. Hoe hoger het nest hoe minder lang hij erover doet.
Zou het omgekeerde verwachten..


```{r}
model_distheight2_all<-lm(Flighttime_min ~ sqrt(I(Distance^2) + I(Height^2)) , na.action=na.exclude, data=Flights_incomplete)
summary(model_distheight2_all)
```

Model volgens Pythagoras? -> Hoogsignificant


**Shortest per individual**
```{r}
model_distheight_ind<-lm(Flighttime_min ~ Distance + Height , na.action=na.exclude, data=Shortind_incomplete)
summary(model_distheight_ind)
```

Height niet significant

```{r}
model_distheight2_ind<-lm(Flighttime_min ~ sqrt(I(Distance^2) + I(Height^2)) , na.action=na.exclude, data=Shortind_incomplete)
summary(model_distheight2_ind)
```

Hoogsignificant

**Shortest per jar**
```{r}
model_distheight_pot<-lm(Flighttime_min ~ Distance + Height , na.action=na.exclude, data=Shortpot_incomplete)
summary(model_distheight_pot)
```
Height niet significant

```{r}
model_distheight2_pot<-lm(Flighttime_min ~ sqrt(I(Distance^2) + I(Height^2)) , na.action=na.exclude, data=Shortpot_incomplete)
summary(model_distheight2_pot)
```
Hoogsignificant



## 6) Speed vs Cloudcoverage

### Graphs

```{r warning=FALSE}
plot13<-ggplot(Flights_incomplete, aes(x=Cloudcoverage, y=Speed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot14<-ggplot(Shortind_incomplete, aes(x=Cloudcoverage, y=Speed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot15<-ggplot(Shortpot_incomplete, aes(x=Cloudcoverage, y=Speed)) + geom_point(color="lightblue") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="darkblue") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot13, plot14, plot15 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

### Model Ouput

**All data**
```{r}
model_cloud_all<-lm(Speed ~ Cloudcoverage, na.action=na.exclude, data=Flights_incomplete)
summary(model_cloud_all)
```
Hoogsignificant

**Shortest per individual**
```{r}
model_cloud_ind<-lm(Speed ~ Cloudcoverage, na.action=na.exclude, data=Shortind_incomplete)
summary(model_cloud_ind)
```
Minder significant

**Shortest per jar**
```{r}
model_cloud_pot<-lm(Speed ~ Cloudcoverage, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_cloud_pot)
```
Niet significant


## 7) Speed vs Weight individual

### Graphs

```{r warning=FALSE}
plot16<-ggplot(Flights_incomplete, aes(x=Weight_ind, y=Speed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot17<-ggplot(Shortind_incomplete, aes(x=Weight_ind, y=Speed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot18<-ggplot(Shortpot_incomplete, aes(x=Weight_ind, y=Speed)) + geom_point(color="plum") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="darkorchid4") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot16, plot17, plot18 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

### Model Output

**All data**
```{r}
model_weight_all<-lm(Speed ~ Weight_ind, na.action=na.exclude, data=Flights_incomplete)
summary(model_weight_all)
```

Niet significant

**Shortest per individual**
```{r}
model_weight_ind<-lm(Speed ~ Weight_ind, na.action=na.exclude, data=Shortind_incomplete)
summary(model_weight_ind)
```

Niet significant

**Shortest per jar**
```{r}
model_weight_pot<-lm(Speed ~ Weight_ind, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_weight_pot)
```

Niet significant



## 8.1) Speed vs Windspeed

### Graphs

Telkens voor de modellen Speed ~ Windspeed en Speed ~ Windspeed + Windspeed²

```{r warning=FALSE}
plot19<-ggplot(Flights_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot20<-ggplot(Shortind_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot21<-ggplot(Shortpot_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x,  se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot22<-ggplot(Flights_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x + I(x^2), se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("All data")+ theme(plot.title = element_text(hjust = 0.5, size=10))

plot23<-ggplot(Shortind_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x + I(x^2), se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per ind.") + theme(plot.title = element_text(hjust = 0.5, size=10))

plot24<-ggplot(Shortpot_incomplete, aes(x=Windspeed, y=Speed)) + geom_point(color="khaki3") + geom_smooth(method="lm", formula =y ~ x + I(x^2),  se=TRUE, fullrange=FALSE, level=0.95, color="olivedrab") + ggtitle("Shortest per jar")+ theme(plot.title = element_text(hjust = 0.5, size=10))

ggarrange(plot19, plot20, plot21, plot22, plot23, plot24 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 3, nrow = 2)
```


### Model Output

**All data**
```{r}
model_wind_all<-lm(Speed ~ Windspeed, na.action=na.exclude, data=Flights_incomplete)
summary(model_wind_all)

model_wind2_all<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=Flights_incomplete)
summary(model_wind2_all)
```

Tweedegraadsmodel significant

**Shortest per individual**

```{r}
model_wind_ind<-lm(Speed ~ Windspeed, na.action=na.exclude, data=Shortind_incomplete)
summary(model_wind_ind)

model_wind2_ind<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=Shortind_incomplete)
summary(model_wind2_ind)
```

Beide niet signifcant

**Shortest per jar**
```{r}
model_wind_pot<-lm(Speed ~ Windspeed, na.action=na.exclude, data=Shortpot_incomplete)
summary(model_wind_pot)

model_wind2_pot<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=Shortpot_incomplete)
summary(model_wind2_pot)
```


## 8.2) Speed vs Windspeed | afhankelijk van de windrichting

Hiervoor werd telkens voor elke meting nagegaan of de hoornaar met meewind (tailwind), tegenwind (upwind) of loodrechte wind (perpendicular) te maken had. Dit volgens de formules:

|𝜃flight −𝜃wind| ≤ 45 is tailwind 

45 < |𝜃flight −𝜃wind|<135 is (quasi) perpendicular 

|𝜃 flight −𝜃wind| ≥135 upwind 


### Graphs

```{r}
ggplot(data=subset(Flights_incomplete, !is.na(Wind)), aes(x= Wind, col=Wind, y=Speed)) + geom_boxplot()

ggplot(data=subset(Flights_incomplete, !is.na(Wind)), aes(x= Windspeed, col=Wind, y=Speed)) + geom_point() + facet_grid(~Wind) + geom_smooth(method="lm", formula = y ~ x + I(x^2), se=TRUE, fullrange=FALSE, level=0.95)

```


### Model Output

```{r}
data_tailwind<-Flights_incomplete %>%  filter(Wind!="tailwind")
data_perpendicular<-Flights_incomplete %>%  filter(Wind!="perpendicular")
data_upwind<-Flights_incomplete %>%  filter(Wind!="upwind")

model_tailwind<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=data_tailwind)
summary(model_tailwind)

model_perpendicular<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=data_perpendicular)
summary(model_perpendicular)

model_upwind<-lm(Speed ~ Windspeed + I(Windspeed^2), na.action=na.exclude, data=data_upwind)
summary(model_upwind)
```
Tailwind significant
Perpendicular niet significant
Upwind enkel 2egraadsterm licht significant



## 9) Flight error vs urbanisation (25m, 50m, 100m)

Flight error is the difference between the actual angle from the bait to the nest and the flight direction I measured.

### Graphs

#### Urbanisatiecirkels
```{r}
plot25<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Urbanisation25m, y=FlightError, fill=Observer)) + geom_point(aes(color=Observer))

plot26<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Urbanisation50m, y=FlightError, fill=Observer)) + geom_point(aes(color=Observer)) 

plot27<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Urbanisation100m, y=FlightError, fill=Observer)) + geom_point(aes(color=Observer))

ggarrange(plot25, plot26, plot27 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```
De foutmarge tussen mij en vrijwilligers lijkt evengroot

```{r}
library(circular)
Errorcirc<-circular(Flights_incomplete$FlightError, type=c("angles"), units=c("degrees"), rotation=c("clock"), zero=0)

lm.circular(Errorcirc, Flights_incomplete$Urbanisation25m, type=c("c-l"), init=c(1))
```
Moet ik 1 invullen bij init?
"a vector with initial values of length equal to the columns of x"

```{r}
lm.circular(Errorcirc, Flights_incomplete$Urbanisation50m, type=c("c-l"), init=c(1))
```
Niet significant

```{r}
lm.circular(Errorcirc, Flights_incomplete$Urbanisation100m, type=c("c-l"), init=c(1))

```
Significant


#### Urbanisatietrajecten

```{r}
plot28<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Traject25m, y=FlightError)) + geom_point(col="hotpink1") + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

plot29<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Traject50m, y=FlightError)) + geom_point(col="hotpink1") + geom_smooth(method="lm", formula =y ~ x , se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

plot30<-ggplot(data=subset(Flights_incomplete, !is.na(Observer)), aes(x=Traject100m, y=FlightError)) + geom_point(col="hotpink1")+ geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

ggarrange(plot28, plot29, plot30 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```

## 10) Flight time vs Urbanisation

### Graphs

#### Urbanisatiecirkels
```{r}
plot30<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Urbanisation25m, y=Flighttime_min)) + geom_point() + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")
               
plot31<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Urbanisation50m, y=Flighttime_min)) + geom_point() +
geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

plot32<-ggplot(data=subset(Shortind_incomplete, !is.na(Observer)), aes(x=Urbanisation100m, y=Flighttime_min)) + geom_point() + geom_smooth(method="lm", formula =y ~ x, se=TRUE, fullrange=FALSE, level=0.95, color="violetred4")

ggarrange(plot30, plot31, plot32 + rremove("x.text"), 
          labels = c("A", "B", "C"),
          ncol = 2, nrow = 2)
```


## Varpart

```{r}
varpart(Flights_incomplete$Flighttime_min, ~Distance, ~Temperatuur, ~Windspeed, na.action=na.exclude, data= Flights_incomplete)
```

**TO DO**
- circulaire statistiek verder uitwerken
- Urbanisatie per vliegtraject








## Statistische modellen probeersels

```{r}
# Model kiezen
library(car)
library(carData)
library(leaps)
select1<-regsubsets(Speed ~ Temperature + Cloudcoverage + Windspeed + Weight_ind, na.action=na.exclude, data=Flights_incomplete, nbest=3)
summary(select1)
plot(select1, scale="adjr2")

select2<-regsubsets(Speed ~ Temperature + Cloudcoverage + Windspeed + Weight_ind + Temperature*Cloudcoverage + Temperature*Windspeed + Temperature*Weight_ind + Cloudcoverage*Windspeed + Cloudcoverage*Weight_ind + Windspeed*Weight_ind, na.action=na.exclude, data=Flights_incomplete, nbest=3)
summary(select2)
plot(select2, scale="adjr2")
```

### Beste model zonder interacties
```{r}
model1<-lm(Speed ~ Temperature + Weight_ind, na.action=na.exclude, data=Flights_incomplete)
summary(model1)
```

### Beste model met 2e graadsinteracties - 1 interactie
```{r}
model2_2<-lm(Speed ~ Temperature + Cloudcoverage + Windspeed + Cloudcoverage*Windspeed, na.action=na.exclude, data=Flights_incomplete)
summary(model2_2)
```

### Beste model met 2e graadsinteracties - 4 interacties
```{r}
# 4 interacties
model2_1<-lm(Speed ~ Temperature + Cloudcoverage + Windspeed + Weight_ind + Temperature*Cloudcoverage + Temperature*Windspeed + Temperature*Weight_ind + Cloudcoverage*Windspeed, na.action=na.exclude, data=Flights_incomplete)
summary(model2_1)
```


## Multicollinearity check
```{r}
library(ggcorrplot)
modelvif<-lm(Speed ~ Temperature + Cloudcoverage + Windspeed + Weight_ind, na.action=na.exclude, data=Flights_incomplete)
vif(modelvif)
datacor<-Flights_incomplete[, c("Temperature", "Cloudcoverage", "Windspeed", "Weight_ind")]
cormat <- round(cor(datacor, use = "pairwise.complete.obs"), 2)
ggcorrplot(cormat, lab= TRUE, type = "lower", ggtheme = ggplot2::theme_gray,
   colors = c("#6D9EC1", "white", "#E46726"))
```

##PCA

```{r}
library(vegan)
library(missMDA)
library(FactoMineR)
datapca<-select(Flights_incomplete, Cloudcoverage, Windspeed, Temperature, Speed, Weight_ind)
nb <- estim_ncpPCA(datapca, scale = TRUE)
comp<-imputePCA(datapca, ncp=2)
res<-PCA(comp$completeObs)
```